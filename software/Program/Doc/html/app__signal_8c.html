<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Metal Detector: C:/Users/Viktor/Desktop/labaratorni/Projects/Metal_Detector/software/Program/SignalsProcessing/Src/app_signal.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Metal Detector
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('app__signal_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">app_signal.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation file for signal processing and FFT operations.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;adc.h&quot;</code><br />
<code>#include &quot;dac.h&quot;</code><br />
<code>#include &quot;tim.h&quot;</code><br />
<code>#include &quot;lvgl.h&quot;</code><br />
<code>#include &quot;<a class="el" href="ui_8h_source.html">ui.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__tasks_8h_source.html">app_tasks.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="app__signal_8h_source.html">app_signal.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a52c22b5e69919a0eb1cedb04095316af" id="r_a52c22b5e69919a0eb1cedb04095316af"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a52c22b5e69919a0eb1cedb04095316af">sig_start</a> (<a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> *const handle)</td></tr>
<tr class="memdesc:a52c22b5e69919a0eb1cedb04095316af"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes and starts the signal processing components.  <br /></td></tr>
<tr class="separator:a52c22b5e69919a0eb1cedb04095316af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab42d526d263f67bfdce169c702b759cf" id="r_ab42d526d263f67bfdce169c702b759cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab42d526d263f67bfdce169c702b759cf">sig_load_samples</a> (<a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> *const handle, uint8_t flag)</td></tr>
<tr class="memdesc:ab42d526d263f67bfdce169c702b759cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads samples into the processing buffers.  <br /></td></tr>
<tr class="separator:ab42d526d263f67bfdce169c702b759cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abba4cc29432394b772c9011f913614f2" id="r_abba4cc29432394b772c9011f913614f2"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abba4cc29432394b772c9011f913614f2">sig_perform_fft</a> (<a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> *const handle)</td></tr>
<tr class="memdesc:abba4cc29432394b772c9011f913614f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs Fast Fourier Transform (FFT) on the signal data.  <br /></td></tr>
<tr class="separator:abba4cc29432394b772c9011f913614f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af20a88180db1113be1e89266917d148b" id="r_af20a88180db1113be1e89266917d148b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af20a88180db1113be1e89266917d148b">HAL_ADC_ConvCpltCallback</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:af20a88180db1113be1e89266917d148b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function for ADC conversion complete interrupt.  <br /></td></tr>
<tr class="separator:af20a88180db1113be1e89266917d148b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7e3dafc08886b97b9c9e23267645b9e" id="r_ad7e3dafc08886b97b9c9e23267645b9e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad7e3dafc08886b97b9c9e23267645b9e">HAL_ADC_ConvHalfCpltCallback</a> (ADC_HandleTypeDef *hadc)</td></tr>
<tr class="memdesc:ad7e3dafc08886b97b9c9e23267645b9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function for ADC half conversion complete interrupt.  <br /></td></tr>
<tr class="separator:ad7e3dafc08886b97b9c9e23267645b9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac7f21f3d46a79fdc0c6fa65c56986e22" id="r_ac7f21f3d46a79fdc0c6fa65c56986e22"><td class="memItemLeft" align="right" valign="top"><a id="ac7f21f3d46a79fdc0c6fa65c56986e22" name="ac7f21f3d46a79fdc0c6fa65c56986e22"></a>
const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>OUTPUT_SINE_SIGNAL</b> [<a class="el" href="app__signal_8h.html#af809317c102809055abaf1f2784e63c2">OUTPUT_SINE_SIGNAL_LEN</a>] = {2048, 3251, 3995, 3996, 3253, 2051, 847, 101, 98, 839}</td></tr>
<tr class="separator:ac7f21f3d46a79fdc0c6fa65c56986e22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e59eb2a63dfbf88f08ffa3c5329c0be" id="r_a9e59eb2a63dfbf88f08ffa3c5329c0be"><td class="memItemLeft" align="right" valign="top">const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e59eb2a63dfbf88f08ffa3c5329c0be">OUTPUT_AUDIO_SIGNAL</a> [<a class="el" href="app__signal_8h.html#a2be5eb41b85fc4affca81a3584699f49">OUTPUT_SINE_AUDIO_LEN</a>]</td></tr>
<tr class="separator:a9e59eb2a63dfbf88f08ffa3c5329c0be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98caec86d718ff9d13350f5f6c0a04b1" id="r_a98caec86d718ff9d13350f5f6c0a04b1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a98caec86d718ff9d13350f5f6c0a04b1">sig_handle</a> = {0}</td></tr>
<tr class="separator:a98caec86d718ff9d13350f5f6c0a04b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation file for signal processing and FFT operations. </p>
<p>This file contains the implementation for handling signal processing tasks, including ADC and DAC setup, sample loading, and FFT operations. Functions include initialization of ADC and DAC, loading samples from the ADC buffer, performing FFT, and handling ADC conversion complete callbacks. The file interfaces with the hardware and performs signal analysis using the CMSIS DSP library.</p>
<p>Created on: Jul 5, 2024 Author: Viktor </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af20a88180db1113be1e89266917d148b" name="af20a88180db1113be1e89266917d148b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af20a88180db1113be1e89266917d148b">&#9670;&#160;</a></span>HAL_ADC_ConvCpltCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HAL_ADC_ConvCpltCallback </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for ADC conversion complete interrupt. </p>
<p>This function is called when the ADC conversion is complete. It places a flag in the message queue to indicate that the ADC data is ready for processing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>Pointer to the ADC_HandleTypeDef structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad7e3dafc08886b97b9c9e23267645b9e" name="ad7e3dafc08886b97b9c9e23267645b9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7e3dafc08886b97b9c9e23267645b9e">&#9670;&#160;</a></span>HAL_ADC_ConvHalfCpltCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HAL_ADC_ConvHalfCpltCallback </td>
          <td>(</td>
          <td class="paramtype">ADC_HandleTypeDef *</td>          <td class="paramname"><span class="paramname"><em>hadc</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for ADC half conversion complete interrupt. </p>
<p>This function is called when half of the ADC conversion is complete. It places a flag in the message queue to indicate that the first half of the ADC data is ready for processing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hadc</td><td>Pointer to the ADC_HandleTypeDef structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab42d526d263f67bfdce169c702b759cf" name="ab42d526d263f67bfdce169c702b759cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab42d526d263f67bfdce169c702b759cf">&#9670;&#160;</a></span>sig_load_samples()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sig_load_samples </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> *const</td>          <td class="paramname"><span class="paramname"><em>handle</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>flag</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads samples into the processing buffers. </p>
<p>Loads samples from the ADC buffer into the processing buffers.</p>
<p>This function copies samples from the input buffer to the processing buffers for further signal analysis. The samples are loaded based on the provided flag.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>Pointer to the <a class="el" href="struct_s_i_g___handle__t.html" title="Handle structure for managing signal processing tasks.">SIG_Handle_t</a> structure containing the buffers. </td></tr>
    <tr><td class="paramname">flag</td><td>Flag indicating the completion status of ADC conversion. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="abba4cc29432394b772c9011f913614f2" name="abba4cc29432394b772c9011f913614f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abba4cc29432394b772c9011f913614f2">&#9670;&#160;</a></span>sig_perform_fft()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t sig_perform_fft </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> *const</td>          <td class="paramname"><span class="paramname"><em>handle</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs Fast Fourier Transform (FFT) on the signal data. </p>
<p>Performs FFT on the loaded signal data and computes magnitude and phase.</p>
<p>This function calculates the FFT of the input signals for both the receive and transmit coils. It then computes the magnitude and phase of the frequency domain data and returns the index of the maximum magnitude value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>Pointer to the <a class="el" href="struct_s_i_g___handle__t.html" title="Handle structure for managing signal processing tasks.">SIG_Handle_t</a> structure containing the signal data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>size_t Index of the maximum magnitude value in the frequency domain. </dd></dl>

</div>
</div>
<a id="a52c22b5e69919a0eb1cedb04095316af" name="a52c22b5e69919a0eb1cedb04095316af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52c22b5e69919a0eb1cedb04095316af">&#9670;&#160;</a></span>sig_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sig_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> *const</td>          <td class="paramname"><span class="paramname"><em>handle</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes and starts the signal processing components. </p>
<p>Starts the signal processing by initializing ADC and DAC, and starting timers.</p>
<p>This function initializes the ADC and DAC peripherals, starts the ADC conversion in DMA mode, and begins the DAC output with a sine wave signal. It also starts the timer used for signal processing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>Pointer to the <a class="el" href="struct_s_i_g___handle__t.html" title="Handle structure for managing signal processing tasks.">SIG_Handle_t</a> structure containing the configuration. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a9e59eb2a63dfbf88f08ffa3c5329c0be" name="a9e59eb2a63dfbf88f08ffa3c5329c0be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e59eb2a63dfbf88f08ffa3c5329c0be">&#9670;&#160;</a></span>OUTPUT_AUDIO_SIGNAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const uint32_t OUTPUT_AUDIO_SIGNAL[<a class="el" href="app__signal_8h.html#a2be5eb41b85fc4affca81a3584699f49">OUTPUT_SINE_AUDIO_LEN</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">        2048, 2176, 2304,</div>
<div class="line">        2431, 2557, 2680, 2801, 2919, 3034, 3145, 3251, 3353, 3449, 3540, 3625,</div>
<div class="line">        3704, 3776, 3842, 3900, 3951, 3995, 4031, 4059, 4079, 4091, 4095, 4091,</div>
<div class="line">        4079, 4059, 4031, 3995, 3951, 3900, 3842, 3776, 3704, 3625, 3540, 3449,</div>
<div class="line">        3353, 3251, 3145, 3034, 2919, 2801, 2680, 2557, 2431, 2304, 2176, 2047,</div>
<div class="line">        1919, 1791, 1664, 1538, 1415, 1294, 1176, 1061, 950, 844, 742, 646, 555,</div>
<div class="line">        470, 391, 319, 253, 195, 144, 100, 64, 36, 16, 4, 0, 4, 16, 36, 64, 100,</div>
<div class="line">        144, 195, 253, 319, 391, 470, 555, 646, 742, 844, 950, 1061, 1176, 1294,</div>
<div class="line">        1415, 1538, 1664, 1791, 1919</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a98caec86d718ff9d13350f5f6c0a04b1" name="a98caec86d718ff9d13350f5f6c0a04b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98caec86d718ff9d13350f5f6c0a04b1">&#9670;&#160;</a></span>sig_handle</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_s_i_g___handle__t.html">SIG_Handle_t</a> sig_handle = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Global handle for signal processing </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_f60fbc6468916523ecfeca29b3541b1e.html">SignalsProcessing</a></li><li class="navelem"><a class="el" href="dir_2de6aaf796cb7e96b85e2aacc036ac38.html">Src</a></li><li class="navelem"><a class="el" href="app__signal_8c.html">app_signal.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
